<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Post Call Summaries : AR Portal</title>

    <!--The CDN-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!--Style Sheets-->
    <link rel="stylesheet" href="../style/main-style.css" />
    <link rel="stylesheet" href="../style/reports-style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <!--Icons-->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
  </head>
  <body>
    <div class="d-flex">
      <nav class="sidebar vh-100 p-4 d-flex flex-column justify-content-center">
        <div>
          <div class="sidebar-header d-flex align-items-center mb-5">
            <!--Need to add CG Logo-->
            <h5 class="text-primary fw-bold">AR Webportal</h5>
          </div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">
                <!--Each Page Show active-->
                <i class="ph-bold ph-layout"></i>
                <!--ICON-->
                <span>Collection Analytics</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./caller.html">
                <i class="ph ph-bell"></i>
                <span>Caller</span>
              </a>
            </li>
            <!--Here we need the Pre-Call and Post-Call -->
            <!--Having two column setup-->

            <!-- <li class="nav-item">
              <a class="nav-link" href="./Pages/caller.html">
                <i class="ph ph-user-list"></i>
                <span>Calls</span>
              </a>
            </li> -->

            <li class="nav-item">
              <a
                class="nav-link active"
                href="#"
                onclick="toggleDropdown(event)"
              >
                <i class="ph ph-user-list"></i>
                <span>Calls</span>
                <i class="ph ph-caret-down arrow-icon"></i>
              </a>
              <ul class="sidebar-dropdown">
                <li>
                  <a class="nav-link dropdown-item" href="./pre-call.html">
                    <i class="ph ph-phone-call"></i>
                    <span>Precall</span>
                  </a>
                </li>
                <li>
                  <a class="nav-link dropdown-item active" href="#">
                    <i class="ph ph-phone-disconnect"></i>
                    <span>Post Call</span>
                  </a>
                </li>
              </ul>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="./reports.html">
                <i class="ph ph-chat-circle-dots"></i>
                <span>Reports</span>
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="ph ph-chart-bar"></i>
                <span>Predective Analytics</span>
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="ph ph-gear"></i>
                <span>Settings</span>
              </a>
            </li>
          </ul>
          <div class="chats-history mt-5">
            <h6 class="text-muted fw-bold ps-3 mb-3">Call History</h6>
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="./History/call-history.html">
                  <i class="ph ph-chat-circle-dots"></i>
                  <span>Call History of Today</span>
                </a>
              </li>
              <li class="nav-item">
                <!-- Here I need to view the transcript -->
                <a class="nav-link" href="./History/client-history.html">
                  <i class="ph ph-archive"></i>
                  <span>Client History</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div
          class="user-profile d-flex align-items-center p-2 rounded-3"
          style="margin-top: 25px"
        >
          <i class="ph-bold ph-user p-1"></i>
          <div class="flex-grow-1">
            <h6 class="mb-0 fw-bold">John Doe</h6>
          </div>
          <i class="ph ph-sign-out"></i>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content flex-grow-1 p-4">
        <header
          class="d-flex justify-content-between align-items-center mb-3 p-1"
          style="background-color: white; border-radius: 15px"
        >
          <h2
            class="fw-bold"
            style="font-size: 1.4rem; padding-left: 1.01rem; padding-top: 5px"
          >
            Post Call Agent Reports
          </h2>
          <div class="d-flex align-items-center">
            <span class="text-muted me-3"
              >Last Update: 14 August 2024, 03:51 PM</span
            >
            <button class="btn btn-icon me-2">
              <i class="ph ph-question"></i>
            </button>
            <button class="btn btn-icon"><i class="ph ph-bell"></i></button>
          </div>
        </header>

        <!-- Date Range Picker -->
        <div class="date-range-picker mb-4">
          <i class="ph ph-calendar-blank"></i>
          <span>14 Aug 2024</span>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar card mb-4">
          <select id="statusFilter" class="form-select">
            <option value="all">View All</option>
            <option value="success">Success</option>
            <option value="notpicked">Not Picked</option>
          </select>
          <input
            type="text"
            id="date-range-picker"
            class="form-control"
            placeholder="Select Date Range"
          />
          <select id="sortFilter" class="form-select">
            <option value="date">Sort by Date</option>
            <option value="amount">Sort by Amount</option>
          </select>
          <!--Small button script to upload data for webcollect it will be done automatically-->
          <button class="btn btn-primary" onclick="handleUpload(this)">
            Upload data to webcollect
          </button>

          <script>
            function handleUpload(button) {
              alert("Manually entered data entered and saved to webcollect");
              button.classList.remove("btn-primary");
              button.classList.add("btn-success");
            }
          </script>
        </div>

        <!-- Report Cards Scrollable Container -->
        <div class="reports-container">
          <div id="cardsContainer" class="row g-4">
            <!-- Cards will be injected here by JavaScript -->
          </div>
        </div>
      </main>
    </div>

    <!-- Transcript Modal -->
    <div
      class="modal fade"
      id="transcriptModal"
      tabindex="-1"
      aria-labelledby="transcriptModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="transcriptModalLabel">
              Transcript for...
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <!--Below in the div we can replace it with the message-->

          <!--After each call we need to display the entire transcript here-->
          <div class="modal-body">
            <textarea
              class="form-control"
              rows="10"
              placeholder="Tom from Capgemini contacted MAX regarding an unpaid invoice of $500.00 that was due on August 01, 2025. MAX confirmed that the payment had already been made. Tom requested payment confirmation or transaction details to verify and update records. MAX agreed to share the details via mail. Tom acknowledged and said he would check email records and follow up if needed. MAX asked Tom to confirm once the records are reviewed. Tom assured MAX that he would review and update accordingly. The call ended with thanks and a goodbye.
"
            ></textarea>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="alert('Transcript Saved')"
            >
              Save Transcript
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Details Modal -->
    <div
      class="modal fade"
      id="detailsModal"
      tabindex="-1"
      aria-labelledby="detailsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailsModalLabel">Details for...</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Important Key Points</th>
                  <!-- <th>Yes / No</th> -->
                  <!-- <th>Detail 3</th>
                  <th>Detail 4</th> -->
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td contenteditable="true"></td>
                  <!-- <td contenteditable="true"></td> -->
                  <!-- <td contenteditable="true"></td>
                  <td contenteditable="true"></td> -->
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                  <!-- <td contenteditable="true"></td> -->
                  <!-- <td contenteditable="true"></td>
                  <td contenteditable="true"></td> -->
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                  <!-- <td contenteditable="true"></td> -->
                  <!-- <td contenteditable="true"></td>
                  <td contenteditable="true"></td> -->
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                  <!-- <td contenteditable="true"></td> -->
                  <!-- <td contenteditable="true"></td>
                  <td contenteditable="true"></td> -->
                </tr>
                <tr>
                  <td contenteditable="true"></td>
                  <!-- <td contenteditable="true"></td> -->
                  <!-- <td contenteditable="true"></td>
                  <td contenteditable="true"></td> -->
                </tr>
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="alert('Additional Report saved for user')"
            >
              Save Report
            </button>
            <!--Additionally, I can take the Data and save it in excel sheet-->
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap & Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="../scripts/drop-down-animation.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const allUsers = [
          {
            // Edit this Details, Add them same from the excel sheet only
            name: "MAX",
            phone: "040-123-123",
            reason: "credit",
            amount: 455.98,
            date: "2025-08-01",
            status: "Success",
          },
          {
            name: "LISA",
            phone: "040-333-111",
            reason: "loan",
            amount: 200.0,
            date: "2025-08-01",
            status: "Not Picked",
          },
          {
            name: "ANNA",
            phone: "040-555-789",
            reason: "loan",
            amount: 320.45,
            date: "2025-08-02",
            status: "Success",
          },
          {
            name: "MARK",
            phone: "040-444-222",
            reason: "bill",
            amount: 550.5,
            date: "2025-08-02",
            status: "Not Picked",
          },
          {
            name: "JOHN",
            phone: "040-222-999",
            reason: "bill",
            amount: 123.0,
            date: "2025-08-03",
            status: "Success",
          },
        ];

        const container = document.getElementById("cardsContainer");
        const statusFilter = document.getElementById("statusFilter");
        const sortFilter = document.getElementById("sortFilter");

        flatpickr("#date-range-picker", {
          mode: "range",
          dateFormat: "Y-m-d",
          altInput: true,
          altFormat: "F j, Y",
        });

        function renderCards(data) {
          container.innerHTML = "";
          data.forEach((user) => {
            const card = document.createElement("div");
            card.className = "col-lg-4 col-md-6";
            const statusClass =
              user.status === "Success" ? "status-success" : "status-fail";
            card.innerHTML = `
            <div class="card report-card">
              <h5 class="card-title">${user.name}</h5>
              <p><strong>Reason:</strong> ${user.reason}</p>
              <p><strong>Due Amount:</strong> $${user.amount.toFixed(2)}</p>
              <p class="status-text ${statusClass}"><strong>Call Status:</strong> ${
              user.status
            }</p>
              <div class="card-actions">
                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#transcriptModal" data-user-name="${
                  user.name
                  //Below this add the other button
                }">Veiw Summary</button>

                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#detailsModal" data-user-name="${
                  user.name
                }">Additional Remark</button>
              </div>
            </div>`;
            container.appendChild(card);
          });
        }

        function sortData(data, sortBy) {
          return data.sort((a, b) => {
            if (sortBy === "date") return new Date(a.date) - new Date(b.date);
            return a.amount - b.amount;
          });
        }

        function updateView() {
          const status = statusFilter.value;
          const sortBy = sortFilter.value;
          let dataToRender =
            status === "all"
              ? [...allUsers]
              : status === "success"
              ? allUsers.filter((u) => u.status === "Success")
              : allUsers.filter((u) => u.status === "Not Picked");
          let sortedData = sortData(dataToRender, sortBy);
          renderCards(sortedData);
        }

        statusFilter.addEventListener("change", updateView);
        sortFilter.addEventListener("change", updateView);

        document
          .getElementById("transcriptModal")
          .addEventListener("show.bs.modal", function (event) {
            const userName = event.relatedTarget.getAttribute("data-user-name");
            this.querySelector(".modal-title").textContent =
              "Transcript for " + userName;
          });

        document
          .getElementById("detailsModal")
          .addEventListener("show.bs.modal", function (event) {
            const userName = event.relatedTarget.getAttribute("data-user-name");
            this.querySelector(".modal-title").textContent =
              "Details for " + userName;
          });

        updateView();
      });
    </script>
  </body>
</html>

<!--You can add this extra button after the View Transcript this will allow you to show a series of table -->

<!-- <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#detailsModal" data-user-name="${
                user.name
                 }">Additional Remark</button> -->
